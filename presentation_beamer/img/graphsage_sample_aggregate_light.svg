<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="700" height="200" viewBox="0 0 700 200" role="img">
  <title>GraphSAGE sample and aggregate</title>
  <defs>
    <linearGradient id="blueGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#3b82f6"/>
      <stop offset="100%" stop-color="#0ea5e9"/>
    </linearGradient>
    <marker id="arrow" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8 z" fill="#f59e0b"/>
    </marker>
    <marker id="arrowGray" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8 z" fill="#64748b"/>
    </marker>
  </defs>

  <!-- Step 1: Sample Neighbors -->
  <g transform="translate(20, 30)">
    <text x="70" y="0" text-anchor="middle" font-family="Arial" font-size="13" font-weight="bold" fill="#1e293b">1. SAMPLE</text>
    
    <!-- Faded non-sampled nodes -->
    <circle cx="30" cy="40" r="12" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="1.5" opacity="0.5"/>
    <circle cx="110" cy="35" r="10" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="1.5" opacity="0.5"/>
    
    <!-- Sampled neighbors -->
    <circle cx="40" cy="90" r="16" fill="url(#blueGrad)" stroke="#1d4ed8" stroke-width="2"/>
    <text x="40" y="95" text-anchor="middle" font-family="Arial" font-size="11" fill="white" font-weight="bold">n1</text>
    
    <circle cx="100" cy="80" r="14" fill="url(#blueGrad)" stroke="#1d4ed8" stroke-width="2"/>
    <text x="100" y="85" text-anchor="middle" font-family="Arial" font-size="11" fill="white" font-weight="bold">n2</text>
    
    <circle cx="70" cy="130" r="15" fill="url(#blueGrad)" stroke="#1d4ed8" stroke-width="2"/>
    <text x="70" y="135" text-anchor="middle" font-family="Arial" font-size="11" fill="white" font-weight="bold">n3</text>
    
    <!-- Edges to target -->
    <g stroke="#94a3b8" stroke-width="1.5" fill="none" opacity="0.6">
      <line x1="55" y1="85" x2="130" y2="95"/>
      <line x1="110" y1="88" x2="130" y2="95"/>
      <line x1="85" y1="125" x2="130" y2="100"/>
    </g>
    
    <!-- Target node -->
    <circle cx="140" cy="95" r="20" fill="#fbbf24" stroke="#d97706" stroke-width="2.5"/>
    <text x="140" y="101" text-anchor="middle" font-family="Arial" font-size="14" fill="#1e293b" font-weight="bold">v</text>
  </g>

  <!-- Arrow to step 2 -->
  <path d="M185 100 L230 100" stroke="#64748b" stroke-width="2.5" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Step 2: Aggregate -->
  <g transform="translate(245, 30)">
    <text x="70" y="0" text-anchor="middle" font-family="Arial" font-size="13" font-weight="bold" fill="#1e293b">2. AGGREGATE</text>
    
    <rect x="10" y="25" width="120" height="110" rx="8" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="2"/>
    
    <!-- Feature vectors -->
    <g transform="translate(25, 45)">
      <rect x="0" y="0" width="90" height="18" rx="4" fill="#3b82f6"/>
      <text x="45" y="13" text-anchor="middle" font-family="monospace" font-size="9" fill="white">h_n1</text>
    </g>
    <g transform="translate(25, 68)">
      <rect x="0" y="0" width="90" height="18" rx="4" fill="#0ea5e9"/>
      <text x="45" y="13" text-anchor="middle" font-family="monospace" font-size="9" fill="white">h_n2</text>
    </g>
    <g transform="translate(25, 91)">
      <rect x="0" y="0" width="90" height="18" rx="4" fill="#06b6d4"/>
      <text x="45" y="13" text-anchor="middle" font-family="monospace" font-size="9" fill="white">h_n3</text>
    </g>
    
    <text x="70" y="130" text-anchor="middle" font-family="Arial" font-size="10" fill="#64748b">mean / sum / max</text>
  </g>

  <!-- Arrow to step 3 -->
  <path d="M390 100 L435 100" stroke="#64748b" stroke-width="2.5" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Step 3: Update -->
  <g transform="translate(450, 30)">
    <text x="70" y="0" text-anchor="middle" font-family="Arial" font-size="13" font-weight="bold" fill="#1e293b">3. UPDATE</text>
    
    <rect x="10" y="25" width="120" height="110" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    
    <!-- Neural network icon -->
    <text x="70" y="55" text-anchor="middle" font-family="Arial" font-size="11" fill="#92400e" font-weight="bold">f_θ (Neural Net)</text>
    
    <!-- Equation -->
    <text x="70" y="80" text-anchor="middle" font-family="monospace" font-size="10" fill="#1e293b">CONCAT(h_v, AGG)</text>
    <text x="70" y="100" text-anchor="middle" font-family="monospace" font-size="10" fill="#1e293b">→ W · σ(·)</text>
    
    <text x="70" y="125" text-anchor="middle" font-family="Arial" font-size="10" fill="#64748b">learned transform</text>
  </g>

  <!-- Arrow to output -->
  <path d="M595 100 L630 100" stroke="#22c55e" stroke-width="2.5" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Output embedding -->
  <g transform="translate(640, 65)">
    <rect x="0" y="0" width="50" height="70" rx="6" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
    <text x="25" y="25" text-anchor="middle" font-family="Arial" font-size="10" font-weight="bold" fill="#166534">New</text>
    <text x="25" y="42" text-anchor="middle" font-family="monospace" font-size="11" fill="#166534">h_v'</text>
    <text x="25" y="60" text-anchor="middle" font-family="Arial" font-size="9" fill="#166534">embed</text>
  </g>

  <!-- Bottom note -->
  <text x="350" y="180" text-anchor="middle" font-family="Arial" font-size="11" fill="#64748b">Repeat for K layers → node embeddings capture K-hop neighborhood structure</text>
</svg>
